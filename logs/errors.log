2024-10-20 18:40:55,229 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:00,253 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:05,277 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:10,313 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:15,341 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:20,369 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:25,389 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:30,426 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:35,453 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:40,498 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:45,526 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:50,557 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:41:55,601 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:42:00,644 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:42:05,690 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-20 18:42:10,730 - ERROR - An error occurred: name 'check_if_terminal_open' is not defined
2024-10-21 10:21:08,366 - ERROR - Exception on request GET /devices/5
Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1403, in handle_request
    return await self.full_dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1441, in full_dispatch_request
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1439, in full_dispatch_request
    result = await self.dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1535, in dispatch_request
    return await self.ensure_async(handler)(**request_.view_args)  # type: ignore
  File "/home/albinr/.local/lib/python3.10/site-packages/quart_auth/globals.py", line 64, in wrapper
    return await current_app.ensure_async(func)(*args, **kwargs)
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 97, in single_device
    return await render_template("single-device.html", device=device)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/templating.py", line 47, in render_template
    return await _render(template, context, current_app._get_current_object())  # type: ignore
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/templating.py", line 66, in _render
    rendered_template = await template.render_async(context)
  File "/home/albinr/.local/lib/python3.10/site-packages/jinja2/environment.py", line 1327, in render_async
    return self.environment.handle_exception()
  File "/home/albinr/.local/lib/python3.10/site-packages/jinja2/environment.py", line 939, in handle_exception
    raise rewrite_traceback_stack(source=source)
  File "/home/albinr/.local/lib/python3.10/site-packages/jinja2/environment.py", line 1324, in <listcomp>
    [n async for n in self.root_render_func(ctx)]  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/templates/single-device.html", line 29, in top-level template code
    <a href="{{ url_for('device_routes.device_terminal', id=device.id) }}">Open terminal</a>
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 734, in url_for
    return self.handle_url_build_error(error, endpoint, values)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 732, in url_for
    url = url_adapter.build(endpoint, values, method=_method, force_external=_external)
  File "/home/albinr/.local/lib/python3.10/site-packages/werkzeug/routing/map.py", line 924, in build
    raise BuildError(endpoint, values, method, self)
werkzeug.routing.exceptions.BuildError: Could not build url for endpoint 'device_routes.device_terminal' with values ['id']. Did you mean 'routes.device_routes.device_terminal' instead?
2024-10-21 11:46:45,706 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 356, in websocket_command_execution
    message = await ws.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 385, in websocket_command_execution
    await ws.close()  # Properly close the WebSocket connection
TypeError: Websocket.close() missing 1 required positional argument: 'code'
2024-10-21 11:46:45,712 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 356, in websocket_command_execution
    message = await ws.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 385, in websocket_command_execution
    await ws.close()  # Properly close the WebSocket connection
TypeError: Websocket.close() missing 1 required positional argument: 'code'
2024-10-21 11:46:49,836 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 356, in websocket_command_execution
    message = await ws.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 385, in websocket_command_execution
    await ws.close()  # Properly close the WebSocket connection
TypeError: Websocket.close() missing 1 required positional argument: 'code'
2024-10-22 12:56:39,205 - ERROR - Exception on request GET /devices/8/terminal
Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1403, in handle_request
    return await self.full_dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1441, in full_dispatch_request
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1439, in full_dispatch_request
    result = await self.dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1535, in dispatch_request
    return await self.ensure_async(handler)(**request_.view_args)  # type: ignore
  File "/home/albinr/.local/lib/python3.10/site-packages/quart_auth/globals.py", line 64, in wrapper
    return await current_app.ensure_async(func)(*args, **kwargs)
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 356, in device_terminal
    client = websocket._get_current_object()
  File "/home/albinr/.local/lib/python3.10/site-packages/werkzeug/local.py", line 519, in _get_current_object
    raise RuntimeError(unbound_message) from None
RuntimeError: Not within a websocket context
2024-10-22 16:41:55,433 - ERROR - Exception on request POST /devices/8/terminal/close
Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1403, in handle_request
    return await self.full_dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1441, in full_dispatch_request
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1439, in full_dispatch_request
    result = await self.dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1535, in dispatch_request
    return await self.ensure_async(handler)(**request_.view_args)  # type: ignore
  File "/home/albinr/.local/lib/python3.10/site-packages/quart_auth/globals.py", line 64, in wrapper
    return await current_app.ensure_async(func)(*args, **kwargs)
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 375, in close_device_terminal
    return redirect(url_for('device_routes.devices'))
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/helpers.py", line 180, in url_for
    return current_app.url_for(
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 734, in url_for
    return self.handle_url_build_error(error, endpoint, values)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 732, in url_for
    url = url_adapter.build(endpoint, values, method=_method, force_external=_external)
  File "/home/albinr/.local/lib/python3.10/site-packages/werkzeug/routing/map.py", line 924, in build
    raise BuildError(endpoint, values, method, self)
werkzeug.routing.exceptions.BuildError: Could not build url for endpoint 'device_routes.devices'. Did you mean 'routes.device_routes.devices' instead?
2024-10-22 17:22:25,900 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 427, in device_websocket
    while True:
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 456, in device_websocket
    await remove_client(hardware_id)  # Remove the client when disconnected
TypeError: Websocket.close() missing 1 required positional argument: 'code'
2024-10-22 17:25:50,589 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 428, in device_websocket
    message = await client.receive()  # Wait for incoming messages
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 457, in device_websocket
    await client.close(code=1000)  # Explicitly close the WebSocket connection
TypeError: Websocket.close() missing 1 required positional argument: 'code'
2024-10-22 18:23:52,397 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 18:32:45,648 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 18:38:16,647 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 21:01:23,861 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 21:07:17,658 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 21:07:39,509 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 21:10:21,618 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 359, in device_websocket
    message = await client.receive()
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 56, in receive
    return await self._receive()
  File "/usr/lib/python3.10/asyncio/queues.py", line 159, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 387, in device_websocket
    await client.close(code=1000)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/wrappers/websocket.py", line 98, in close
    await self._close(code, reason)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/asgi.py", line 301, in close_connection
    raise RuntimeError("Cannot close websocket multiple times")
RuntimeError: Cannot close websocket multiple times
2024-10-22 21:16:33,618 - ERROR - Exception on websocket /ws/device/55c97bf4-7bea-11ef-a011-efb03faa974e
Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1415, in handle_websocket
    return await self.full_dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1463, in full_dispatch_websocket
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1461, in full_dispatch_websocket
    result = await self.dispatch_websocket(websocket_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1551, in dispatch_websocket
    return await self.ensure_async(handler)(**websocket_.view_args)  # type: ignore
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 390, in device_websocket
    if not client.closed:
AttributeError: 'Websocket' object has no attribute 'closed'. Did you mean: 'close'?
2024-10-22 22:15:35,561 - ERROR - Exception on request GET /devices/8/terminal
Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1403, in handle_request
    return await self.full_dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1441, in full_dispatch_request
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1439, in full_dispatch_request
    result = await self.dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1535, in dispatch_request
    return await self.ensure_async(handler)(**request_.view_args)  # type: ignore
  File "/home/albinr/.local/lib/python3.10/site-packages/quart_auth/globals.py", line 64, in wrapper
    return await current_app.ensure_async(func)(*args, **kwargs)
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 324, in device_terminal
    return redirect(url_for('device_routes.devices'))
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/helpers.py", line 180, in url_for
    return current_app.url_for(
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 734, in url_for
    return self.handle_url_build_error(error, endpoint, values)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 732, in url_for
    url = url_adapter.build(endpoint, values, method=_method, force_external=_external)
  File "/home/albinr/.local/lib/python3.10/site-packages/werkzeug/routing/map.py", line 924, in build
    raise BuildError(endpoint, values, method, self)
werkzeug.routing.exceptions.BuildError: Could not build url for endpoint 'device_routes.devices'. Did you mean 'routes.device_routes.devices' instead?
2024-10-23 23:48:24,155 - ERROR - Exception on request POST /device/8/delete
Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1936, in _exec_single_context
    self.dialect.do_executemany(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 938, in do_executemany
    cursor.executemany(statement, parameters)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 158, in executemany
    self._adapt_connection._handle_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 298, in _handle_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 152, in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/cursor.py", line 55, in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/core.py", line 132, in _execute
    return await future
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/core.py", line 115, in run
    result = function()
sqlite3.IntegrityError: NOT NULL constraint failed: device_requests.device_id

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1403, in handle_request
    return await self.full_dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1441, in full_dispatch_request
    result = await self.handle_user_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1029, in handle_user_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1439, in full_dispatch_request
    result = await self.dispatch_request(request_context)
  File "/home/albinr/.local/lib/python3.10/site-packages/quart/app.py", line 1535, in dispatch_request
    return await self.ensure_async(handler)(**request_.view_args)  # type: ignore
  File "/home/albinr/.local/lib/python3.10/site-packages/quart_auth/globals.py", line 64, in wrapper
    return await current_app.ensure_async(func)(*args, **kwargs)
  File "/home/albinr/git/bth/c2app-proj/c2app-server/routes/devices.py", line 107, in post_delete_device
    await session.commit()
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/ext/asyncio/session.py", line 1009, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1936, in _exec_single_context
    self.dialect.do_executemany(
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 938, in do_executemany
    cursor.executemany(statement, parameters)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 158, in executemany
    self._adapt_connection._handle_exception(error)
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 298, in _handle_exception
    raise error
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 152, in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
  File "/home/albinr/.local/lib/python3.10/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/cursor.py", line 55, in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/core.py", line 132, in _execute
    return await future
  File "/home/albinr/.local/lib/python3.10/site-packages/aiosqlite/core.py", line 115, in run
    result = function()
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: device_requests.device_id
[SQL: UPDATE device_requests SET device_id=? WHERE device_requests.id = ?]
[parameters: [(None, 1), (None, 2), (None, 3), (None, 4), (None, 5), (None, 10), (None, 11), (None, 12)  ... displaying 10 of 17 total bound parameter sets ...  (None, 25), (None, 29)]]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
